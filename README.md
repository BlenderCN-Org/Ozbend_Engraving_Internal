# Engraving_Internal
Engraving_Internal - часть проекта Ozbend_Jewelry_Render для рендера гравировки отдельно от мешей.

Установка
-

- Скачать zip-файл с дистрибутивом
- В Blender: User Preferences - Add-ons - Install from File - указать скачанный архив


# Использование
Алгоритм работы, подготовки файлов, наименования материалов и мешей какой же, как в исходном Ozbend_Jewelry_Render_v2.

**Изменения:**

- движок рендера Blender Render (internal) / Blender Cycles (cycles)
- Всем мешам без гравировки назначается прозрачный материал
- Всем мешам с гравировкой назначается материал текстуры с прозрачным фоном

**Результат рендера:**

Одна гравировка "висящая в воздухе", без мешей.

# Подготовка сцены (Internal)

В сцене должны присутствовать 2 материала с именами:

- Trans_internal - материал полностью прозраный (назначается мешам без гравировки)
- Gravi_internal - материал текстуры на прозрачном фоне (назначается мешам с гравировкой)

**Прозрачный фон на рендере:**

окно Properties - вкладка Render:

панель Output - установить формат PNG (RGBA)

панель Shading - установить Alpha = Transparent

**Прозрачный материал:**

окно Properties - вкладка Material - для материала меша:

панель Transparencу - установить галочку и поставить Alpha = 0

**Текстура с прозрачным фоном**

материал - так же,как для прозрачного материала

панель Texture - создать новую текстуру в слоте 0 (первый слот)

type = Image or Movie

панель Image - добавить нужную текстуру (формат png, прозрачный фон)

панель Influence - отметить галочку Alpha

панель Mapping - установить Coordinates = UV

**Камеры**

Все камеры должны быть пронумерованы. Номер камеры - 2 последних символа в ее имени.

# Подготовка сцены (Cycles)

- Trans_cycles - материал полностью прозраный (назначается мешам без гравировки)

Создается через дерево нодов.

Один нод Transparen

- Gravi_cycles - материал текстуры на прозрачном фоне (назначается мешам с гравировкой)

Создается через дерево нодов.

Ноды Transparent и Цвет гравировки (может быть группа нодов) связываются через нод Mix Shader. Transparent - верхний вход, Цвет гравировки - нижний.

В Factor нода Mix ставится выход Alpha нода Image Texture. Нод Image Texture обязательно должен иметь имя "Gravi_Text". Вход Vector запитпть от нода UVMap.

**Камеры**

Все камеры должны быть пронумерованы. Номер камеры - 2 последних символа в ее имени.

# Использование аддона в консольном режиме (без GUI)

Операционная система: linux

**Установка Blender**

    apt-get install blender

**Проверка установленной версии**

    blender -v

Аддон "Engraving Internal" разработан для версии Blender 2.79. Корректная работа на иных версиях возможна, но не гарантируется.

**Инсталляция аддона**

Скопировать архив аддона (*.zip) в директорию /tmp/

Скопировать отдельно файл для инсталляции аддона addon_install.py (находится в архиве аддона) в директорию /tmp/

Запустить установку аддона командой:

    blender -b -P /tmp/addon_install.py -- -f /tmp/Ozbend_Engraving_Internal-master.zip

**Запуск рендера с использованием аддона**

Скопировать файл сцены (*.blend + options.json) в директорию /tmp/

В файле options.json откорректировать текущие настройки. В директории source должны присутствовать файлы *.obj для рендера.

Скопировать отдельно файл addon_execute.py (находится в архиве аддона) в директорию /tmp/

Запустить рендер сцены командой:

    blender -b /tmp/scene.blend -P /tmp/addon_execute.py -- -sx 300 -sy 600 -s 0.5 -sa 10 -n NewName -p /tmp/dest1 -o /tmp -g /tmp/new_gravi.png -c 1-2-34 -e internal

Параметры командной строки:

    -b - фоновый запуск Blender
    /tmp/scene.blend - Путь к сцене для рендера
    -P - запуск скрипта при выполнении команды
    /tmp/addon_execute.py - полный путь к исполняемому скрипту
    -sx - разрешение готового изображения по оси X (в пикселях)
    -sy - разрешение готового изображения по оси Y (в пикселях)
    -s - масштаб импортируемого из *.obj файла меша
    -sa - количество проходов рендера (samples)
    -n - Имя заменяющее имя *.obj файла в готовом рендере
    -p - Кастомный путь для сохранения готовых рендеров
    -o - Путь к импортируемым *.obj (заменяет указанный в options.json)
    -g - Путь к специальному файлу с гравировкой (если он есть - гравировка из этого файла ставится на место всех гравировок в *.obj)
    -c - Указание номеров камер (последние 2 цифры в имени камеры) сцены, с которых производить рендер. Разделяются знаком "-" без пробелов
    -e - Рендер-движок ("cycles" или "internal")
